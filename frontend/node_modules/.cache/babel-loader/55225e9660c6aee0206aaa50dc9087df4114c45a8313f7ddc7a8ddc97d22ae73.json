{"ast":null,"code":"var _jsxFileName = \"/home/robo/eConsult-Insight/frontend/src/GetLink.js\",\n  _s = $RefreshSig$();\nimport { useRef, useState, useEffect } from \"react\";\nimport './App.css';\nimport Result from \"./result\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst GetLink = () => {\n  _s();\n  // State for the link input\n  const [link, setLink] = useState('');\n  // State to track if the link has been submitted and is being processed\n  const [isProcessing, setIsProcessing] = useState(false);\n  // State to hold the final processed result data (text)\n  const [processedResult, setProcessedResult] = useState(null);\n  // State to manage any errors\n  const [error, setError] = useState(null);\n\n  // We can remove inputRef since we're using a controlled input with onChange.\n  // const inputRef = useRef(); \n\n  // 1. Function to handle link submission\n  const handleSubmit = async event => {\n    event.preventDefault();\n    if (!link) {\n      setError(\"Please enter a valid link.\");\n      return;\n    }\n    setError(null);\n    setIsProcessing(true); // Start processing state\n    setProcessedResult(null); // Clear previous result\n\n    console.log(\"Submitting link for analysis:\", link);\n    const formData = new FormData();\n    formData.append(\"text\", link);\n    try {\n      const endpoint = \"/upload/\";\n      const response = await fetch(endpoint, {\n        method: \"POST\",\n        body: formData\n      });\n      if (response.ok) {\n        // If the upload is successful, we wait for the useEffect to fetch the result.\n        console.log(\"Link submitted successfully. Awaiting processing.\");\n      } else {\n        // Handle non-200 responses\n        const errorText = await response.text();\n        throw new Error(`Server failed to process link: ${errorText}`);\n      }\n    } catch (err) {\n      console.error(\"Submission error:\", err);\n      setError(`Failed to submit link. Please check your network. (${err.message})`);\n      setIsProcessing(false); // Stop processing state on failure\n    }\n  };\n\n  // 2. useEffect to fetch the final result after submission succeeds\n  useEffect(() => {\n    // This only runs if we are currently processing (link submission was successful)\n    if (isProcessing) {\n      const fetchProcessedText = async () => {\n        try {\n          // Assuming your backend finishes processing *after* the /upload/\n          // call returns, and you can now fetch the result.\n          const response = await fetch('/result/processed_comments/');\n          if (!response.ok) {\n            throw new Error(`Failed to fetch processed result: ${response.statusText}`);\n          }\n          const data = await response.json();\n\n          // Assuming 'data' is an object like: \n          // { word_cloud: {word: freq}, sentiment: {key: value}, texts: [] }\n          setProcessedResult(data); // Store the structured data\n          setIsProcessing(false); // Stop processing state on success\n          console.log(\"Structured data fetched:\", data);\n        } catch (err) {\n          console.error('Error fetching structured data:', err);\n          setError(`Error retrieving result. Expected JSON data but received an error: ${err.message}`);\n          setIsProcessing(false);\n        }\n      };\n\n      // NOTE: You might need a more sophisticated polling mechanism \n      // if processing takes a long time, but for a simple fix, \n      // we assume the result is ready shortly after /upload/ succeeds.\n\n      // A simple delay might be used here if you know the result isn't instant.\n      // For now, we call it immediately.\n      fetchProcessedText();\n    }\n  }, [isProcessing]);\n\n  // --- RENDERING LOGIC ---\n\n  // 1. Display error message\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-message\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Error\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => {\n          setIsProcessing(false);\n          setError(null);\n          setLink('');\n        },\n        children: \"Try Again\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 13\n    }, this);\n  }\n\n  // 2. Display processing/loading state\n  if (isProcessing) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"processing\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Please wait while we process your comments...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"spinner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 13\n    }, this);\n  }\n\n  // 3. Display the final result\n  if (processedResult) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Result(processedResult)\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 13\n    }, this);\n  }\n\n  // 4. Display the initial input form\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"textzone\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \" Paste the link of website that has the comments \"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"url\",\n        value: link,\n        onChange: e => setLink(e.target.value),\n        placeholder: \"e.g., https://example.com/page-with-comments\",\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        children: \"Analyze Comments\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 133,\n    columnNumber: 9\n  }, this);\n};\n_s(GetLink, \"sIGStnkqB8n6W+49sxDZ3K8adew=\");\n_c = GetLink;\nexport default GetLink;\nvar _c;\n$RefreshReg$(_c, \"GetLink\");","map":{"version":3,"names":["useRef","useState","useEffect","Result","jsxDEV","_jsxDEV","GetLink","_s","link","setLink","isProcessing","setIsProcessing","processedResult","setProcessedResult","error","setError","handleSubmit","event","preventDefault","console","log","formData","FormData","append","endpoint","response","fetch","method","body","ok","errorText","text","Error","err","message","fetchProcessedText","statusText","data","json","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","onSubmit","type","value","onChange","e","target","placeholder","required","_c","$RefreshReg$"],"sources":["/home/robo/eConsult-Insight/frontend/src/GetLink.js"],"sourcesContent":["import { useRef, useState, useEffect } from \"react\";\r\nimport './App.css'\r\nimport Result from \"./result\";\r\n\r\n\r\nconst GetLink = () => {\r\n    // State for the link input\r\n    const [link, setLink] = useState('');\r\n    // State to track if the link has been submitted and is being processed\r\n    const [isProcessing, setIsProcessing] = useState(false);\r\n    // State to hold the final processed result data (text)\r\n    const [processedResult, setProcessedResult] = useState(null);\r\n    // State to manage any errors\r\n    const [error, setError] = useState(null);\r\n    \r\n    // We can remove inputRef since we're using a controlled input with onChange.\r\n    // const inputRef = useRef(); \r\n\r\n    // 1. Function to handle link submission\r\n    const handleSubmit = async (event) => {\r\n        event.preventDefault();\r\n        \r\n        if (!link) {\r\n            setError(\"Please enter a valid link.\");\r\n            return;\r\n        }\r\n\r\n        setError(null);\r\n        setIsProcessing(true); // Start processing state\r\n        setProcessedResult(null); // Clear previous result\r\n        \r\n        console.log(\"Submitting link for analysis:\", link);\r\n        \r\n        const formData = new FormData();\r\n        formData.append(\"text\", link);\r\n\r\n        try {\r\n            const endpoint = \"/upload/\";\r\n            const response = await fetch(endpoint, {\r\n                method: \"POST\",\r\n                body: formData\r\n            });\r\n\r\n            if (response.ok) {\r\n                // If the upload is successful, we wait for the useEffect to fetch the result.\r\n                console.log(\"Link submitted successfully. Awaiting processing.\");\r\n            } else {\r\n                // Handle non-200 responses\r\n                const errorText = await response.text();\r\n                throw new Error(`Server failed to process link: ${errorText}`);\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Submission error:\", err);\r\n            setError(`Failed to submit link. Please check your network. (${err.message})`);\r\n            setIsProcessing(false); // Stop processing state on failure\r\n        }\r\n    };\r\n\r\n    // 2. useEffect to fetch the final result after submission succeeds\r\n    useEffect(() => {\r\n        // This only runs if we are currently processing (link submission was successful)\r\n        if (isProcessing) {\r\n            const fetchProcessedText = async () => {\r\n                try {\r\n                    // Assuming your backend finishes processing *after* the /upload/\r\n                    // call returns, and you can now fetch the result.\r\n                    const response = await fetch('/result/processed_comments/');\r\n                    \r\n                    if (!response.ok) {\r\n                         throw new Error(`Failed to fetch processed result: ${response.statusText}`);\r\n                    }\r\n                    \r\n                    const data = await response.json(); \r\n                    \r\n                    // Assuming 'data' is an object like: \r\n                    // { word_cloud: {word: freq}, sentiment: {key: value}, texts: [] }\r\n                    setProcessedResult(data); // Store the structured data\r\n                    setIsProcessing(false); // Stop processing state on success\r\n                    console.log(\"Structured data fetched:\", data);\r\n\r\n                } catch (err) {\r\n                    console.error('Error fetching structured data:', err);\r\n                    setError(`Error retrieving result. Expected JSON data but received an error: ${err.message}`);\r\n                    setIsProcessing(false);\r\n                }\r\n            };\r\n            \r\n            // NOTE: You might need a more sophisticated polling mechanism \r\n            // if processing takes a long time, but for a simple fix, \r\n            // we assume the result is ready shortly after /upload/ succeeds.\r\n            \r\n            // A simple delay might be used here if you know the result isn't instant.\r\n            // For now, we call it immediately.\r\n            fetchProcessedText();\r\n        }\r\n    }, [isProcessing]);\r\n\r\n\r\n    // --- RENDERING LOGIC ---\r\n\r\n    // 1. Display error message\r\n    if (error) {\r\n        return (\r\n            <div className=\"error-message\">\r\n                <h1>Error</h1>\r\n                <p>{error}</p>\r\n                <button onClick={() => { setIsProcessing(false); setError(null); setLink(''); }}>Try Again</button>\r\n            </div>\r\n        );\r\n    }\r\n    \r\n    // 2. Display processing/loading state\r\n    if (isProcessing) {\r\n        return (\r\n            <div className=\"processing\">\r\n                <h1>Please wait while we process your comments...</h1>\r\n                <div className=\"spinner\" /> \r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 3. Display the final result\r\n    if (processedResult) {\r\n        return (\r\n            <div>\r\n                Result(processedResult)\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // 4. Display the initial input form\r\n    return (\r\n        <div className=\"textzone\">\r\n            <h1> Paste the link of website that has the comments </h1>\r\n            <form onSubmit={handleSubmit}>\r\n                <input\r\n                    type=\"url\"\r\n                    value={link}\r\n                    onChange={(e) => setLink(e.target.value)}\r\n                    placeholder=\"e.g., https://example.com/page-with-comments\"\r\n                    required\r\n                />\r\n                <button type=\"submit\">Analyze Comments</button>\r\n            </form>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default GetLink;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}